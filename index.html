<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Go Taxi ‚Äì One Way Booking</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<style>
*{box-sizing:border-box}
body{margin:0;font-family:Arial;background:#f4f6f8}
header{background:#ff9800;color:#fff;padding:15px;text-align:center;font-size:18px}
.box{max-width:900px;margin:15px auto;background:#fff;padding:15px;border-radius:6px}
label{font-weight:bold;margin-top:12px;display:block}
input,select,button{width:100%;padding:10px;margin-top:6px;font-size:16px}
button{background:#ff9800;color:#fff;border:none;cursor:pointer}
.card{border:1px solid #ddd;padding:15px;margin-top:15px;border-radius:5px}
.row{display:flex;gap:10px;flex-wrap:wrap}
.row>div{flex:1;min-width:140px}
.small{font-size:13px;color:#555}
.price{font-size:20px;font-weight:bold;margin-top:8px}
.hidden{display:none}
.btn2{background:#333}
@media(max-width:600px){
  header{font-size:16px}
  .box{margin:8px}
}
</style>
</head>

<body>

<header>Go Taxi ‚Äì One Way Booking</header>

<div class="box">

<!-- STEP 1 -->
<h3>Customer Details</h3>
<label>Full Name</label>
<input id="name">
<label>Mobile Number</label>
<input id="mobile">
<label>Email (optional)</label>
<input id="email">

<button onclick="goStep2()">Continue</button>

<!-- STEP 2 -->
<div id="step2" class="hidden">
<h3>Trip Details</h3>

<div class="row">
  <div>
    <label>Pickup Date</label>
    <input type="date" id="date">
  </div>
  <div>
    <label>Pickup Time</label>
    <input type="time" id="time">
  </div>
</div>

<label>Pickup Location</label>
<select id="pickup"></select>

<label>Drop Location</label>
<select id="drop"></select>

<button onclick="seePrice()">See Price</button>
</div>

<!-- STEP 3 -->
<div id="priceBox" class="hidden">
<h3>Fare Details</h3>
<div id="fareDetails"></div>

<div class="row">
  <div>
    <button onclick="openGST()">Book With GST</button>
  </div>
  <div>
    <button class="btn2" onclick="payWithoutGST()">Book Without GST</button>
  </div>
</div>
</div>

<!-- GST FORM -->
<div id="gstBox" class="hidden">
<h3>Company Details (GST Invoice)</h3>
<label>Company Name</label>
<input id="cname">
<label>GST Number</label>
<input id="gstno">
<label>Company Address</label>
<input id="caddr">
<button onclick="payWithGST()">Proceed to Payment</button>
</div>

<!-- DONE -->
<div id="done" class="hidden">
<h3>Thank You üôè</h3>
<p>Your booking request has been submitted.</p>
<p class="small">
Our team will contact you shortly.<br>
üìû 8434143546 / 7480877981<br>
üåê www.gotaxiservices.com
</p>
</div>

</div>

<script>
let routes = [];
let selectedRoute = null;
let finalAmount = 0;

/* LOAD ROUTES FROM ADMIN (NO FALLBACK) */
function loadRoutes(){
  const raw = localStorage.getItem("oneWayRoutes");
  if(!raw){
    alert("No One Way routes found. Please open Admin panel and save routes on this device.");
    return;
  }

  routes = JSON.parse(raw);

  pickup.innerHTML = "<option value=''>Select Pickup</option>";
  drop.innerHTML   = "<option value=''>Select Drop</option>";

  const pickups = [...new Set(routes.map(r => r.pickup))];
  pickups.forEach(p => pickup.add(new Option(p,p)));

  pickup.onchange = loadDrops;
}

/* DROPS */
function loadDrops(){
  drop.innerHTML = "<option value=''>Select Drop</option>";
  routes
    .filter(r => r.pickup === pickup.value)
    .forEach(r => drop.add(new Option(r.drop, r.drop)));
}

/* STEP FLOW */
function goStep2(){
  document.getElementById("step2").classList.remove("hidden");
}

/* PRICE */
function seePrice(){
  selectedRoute = routes.find(r =>
    r.pickup === pickup.value && r.drop === drop.value
  );

  if(!selectedRoute){
    alert("This route is not available for One Way.");
    return;
  }

  const base = Number(selectedRoute.price);
  const gst  = Math.round(base * 0.05);
  finalAmount = base + gst;

  fareDetails.innerHTML = `
    <div class="card">
      <b>${selectedRoute.pickup} ‚Üí ${selectedRoute.drop}</b><br><br>
      <b>KM Limit:</b> ${Number(selectedRoute.km)} KM<br>
      <b>Base Fare:</b> ‚Çπ${base}<br>
      <b>Extra KM:</b> ‚Çπ${selectedRoute.extra} / KM<br><br>
      <b>Toll:</b> ${selectedRoute.toll}<br>
      <b>Parking:</b> ${selectedRoute.parking}<br>
      <b>State Tax:</b> ${selectedRoute.state}<br><br>
      <div class="price">‚Çπ${finalAmount} (with GST)</div>
      <div class="small">‚Çπ${base} (without GST)</div>
    </div>
  `;
  priceBox.classList.remove("hidden");
}

/* GST FLOW */
function openGST(){
  gstBox.classList.remove("hidden");
}

/* PAYMENTS */
function payWithoutGST(){
  razorpayPay(Number(selectedRoute.price), name.value || "Customer");
}
function payWithGST(){
  razorpayPay(finalAmount, cname.value || "Company");
}

/* RAZORPAY (NO √ó100 BUG) */
function razorpayPay(amount, payer){
  const options = {
    key: "rzp_test_S5hF2aCSZUMWAI",
    amount: Math.round(amount * 100), // ONLY HERE
    currency: "INR",
    name: "Go Taxi Services",
    description: "One Way Booking",
    handler: function (){
      priceBox.classList.add("hidden");
      gstBox.classList.add("hidden");
      done.classList.remove("hidden");
    },
    prefill: {
      name: payer,
      email: email.value,
      contact: mobile.value
    },
    theme:{color:"#ff9800"}
  };
  new Razorpay(options).open();
}

/* INIT */
loadRoutes();
</script>

</body>
</html>
