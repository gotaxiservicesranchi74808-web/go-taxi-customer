<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Go Taxi – Round Trip Booking</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:Arial;background:#f4f6f8;margin:0}
header{background:#ff9800;color:#fff;padding:15px;text-align:center}
.box{max-width:900px;margin:15px auto;background:#fff;padding:15px;border-radius:6px}
label{font-weight:bold;margin-top:12px;display:block}
input,select,button{width:100%;padding:10px;margin-top:6px;font-size:15px}
button{background:#ff9800;color:#fff;border:none;cursor:pointer}
.row{display:flex;gap:10px;flex-wrap:wrap}
.row>div{flex:1}
.via{border:1px dashed #ccc;padding:8px;margin-top:6px}
.price{font-size:20px;font-weight:bold;margin-top:10px}
.small{font-size:13px;color:#555}
</style>
</head>

<body>

<header>Go Taxi – Round Trip Booking</header>

<div class="box">

<label>Pickup Location</label>
<input id="pickup" placeholder="Ranchi">

<label>Going On (Via City)</label>
<div id="viaBox"></div>
<button type="button" onclick="addVia()">➕ Add Another Destination</button>

<label>Drop Location</label>
<input id="drop" readonly>

<div class="row">
  <div>
    <label>Pickup Date</label>
    <input type="date" id="pdate">
  </div>
  <div>
    <label>Release Date</label>
    <input type="date" id="rdate">
  </div>
</div>

<div class="row">
  <div>
    <label>Pickup Time</label>
    <input type="time" id="ptime">
  </div>
  <div>
    <label>Release Time</label>
    <input type="time" id="rtime">
  </div>
</div>

<label>Total Trip KM</label>
<input type="number" id="km" placeholder="Enter total KM">

<label>Select Cab Type</label>
<select id="car">
  <option>Loading...</option>
</select>

<button onclick="calculate()">Calculate Fare</button>

<div id="output"></div>

</div>

<script>
/* GOOGLE SHEET API */
const ROUND_TRIP_API =
"https://script.google.com/macros/s/AKfycbyXk3kPPx3OR-d-hFgnk6rUeUtxRVtCwQCzBxlz55JLB9BCiofJjNF_qor3l_Np4sk/exec";

let rates=[];

/* Load rates */
fetch(ROUND_TRIP_API)
.then(r=>r.json())
.then(data=>{
  rates=data;
  car.innerHTML='<option value="">Select Cab</option>';
  data.forEach(r=>{
    car.innerHTML+=`<option value="${r.car_type}">${r.car_type}</option>`;
  });
});

/* Pickup = Drop */
pickup.addEventListener("input",()=>{
  drop.value = pickup.value;
});

/* Add via destination */
function addVia(){
  const d=document.createElement("div");
  d.className="via";
  d.innerHTML=`<input placeholder="Via destination">`;
  document.getElementById("viaBox").appendChild(d);
}

/* Calculate fare */
function calculate(){
  if(!pickup.value||!pdate.value||!rdate.value||!ptime.value||!rtime.value||!km.value||!car.value){
    alert("Please fill all details");
    return;
  }

  const rate = rates.find(r=>r.car_type===car.value);
  if(!rate){ alert("Rate not found"); return; }

  const start = new Date(pdate.value+"T"+ptime.value);
  const end   = new Date(rdate.value+"T"+rtime.value);
  end.setHours(23,59,0);

  const days = Math.max(1, Math.ceil((end-start)/(1000*60*60*24)));
  const minKm = days * 250;
  const chargeKm = Math.max(Number(km.value), minKm);

  const running = chargeKm * Number(rate.per_km_rate);

  const base    = Number(rate.base_fare) * days;          // ✅ FIXED
  const driver  = Number(rate.driver_allowance) * days;   // ✅ FIXED

  const withoutGST = base + running + driver;
  const gst = Math.round(withoutGST * Number(rate.gst) / 100);
  const withGST = withoutGST + gst;

  let route = pickup.value;
  document.querySelectorAll("#viaBox input").forEach(v=>{
    if(v.value) route += " → " + v.value;
  });
  route += " → " + pickup.value;

  output.innerHTML = `
    <div class="price">₹${withGST} (With GST)</div>
    ₹${withoutGST} (Without GST)
    <div class="small">
      <br><b>Route:</b> ${route}
      <br><b>Days:</b> ${days}
      <br><b>KM Charged:</b> ${chargeKm} (Min ${minKm})
      <br>Toll / Parking / State Tax extra
    </div>
  `;
}
</script>

</body>
</html>
